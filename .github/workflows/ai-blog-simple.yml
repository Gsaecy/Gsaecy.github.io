name: AI Blog Simple Version

on:
  workflow_dispatch:
    inputs:
      mode:
        description: 'è¿è¡Œæ¨¡å¼'
        required: false
        default: 'test'
        type: choice
        options:
          - test
          - full

env:
  PYTHON_VERSION: '3.11'
  HUGO_VERSION: 'latest'

jobs:
  check-secret:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Check Secret
        env:
          API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        run: |
          echo "ðŸ” æ£€æŸ¥Secret..."
          if [ -z "$API_KEY" ]; then
            echo "âŒ DEEPSEEK_API_KEYæœªè®¾ç½®"
            exit 1
          fi
          echo "âœ… Secretæ£€æŸ¥é€šè¿‡"
          echo "Keyé•¿åº¦: ${#API_KEY}"
          echo "Keyæ ¼å¼: ${API_KEY:0:10}..."

  generate-content:
    needs: check-secret
    if: github.event.inputs.mode == 'full'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      
      - name: Install dependencies
        run: |
          pip install requests beautifulsoup4
      
      - name: Generate sample article
        env:
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        run: |
          echo "ç”Ÿæˆç¤ºä¾‹æ–‡ç« ..."
          mkdir -p content/posts
          
          cat > content/posts/sample-$(date +%Y%m%d).md << 'EOF'
          ---
          title: "AIæ™ºæ±‡è§‚å¯Ÿæµ‹è¯•æ–‡ç« "
          date: $(date -Iseconds)
          draft: false
          tags: ["æµ‹è¯•", "AI"]
          categories: ["æµ‹è¯•"]
          ---
          
          # æµ‹è¯•æ–‡ç« 
          
          è¿™æ˜¯AIæ™ºæ±‡è§‚å¯Ÿç³»ç»Ÿçš„æµ‹è¯•æ–‡ç« ã€‚
          
          ## ç³»ç»ŸçŠ¶æ€
          - **ç‰ˆæœ¬**: v2.1
          - **çŠ¶æ€**: æµ‹è¯•è¿è¡Œä¸­
          - **æ—¶é—´**: $(date)
          
          ## ä¸‹ä¸€æ­¥
          å¦‚æžœçœ‹åˆ°è¿™ç¯‡æ–‡ç« ï¼Œè¯´æ˜Žç³»ç»ŸåŸºæœ¬å·¥ä½œæ­£å¸¸ã€‚
          
          ---
          *AIæ™ºæ±‡è§‚å¯Ÿç³»ç»Ÿ*
          EOF
          
          echo "æ–‡ç« å·²ç”Ÿæˆ"

  build:
    needs: generate-content
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: ${{ env.HUGO_VERSION }}
          extended: true
      
      - name: Build Hugo site
        run: hugo --minify

  report:
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Generate report
        run: |
          echo "# è¿è¡ŒæŠ¥å‘Š" > report.md
          echo "æ—¶é—´: $(date)" >> report.md
          echo "å·¥ä½œæµ: AI Blog Simple Version" >> report.md
          echo "æ¨¡å¼: ${{ github.event.inputs.mode }}" >> report.md
          echo "çŠ¶æ€: ${{ job.status }}" >> report.md
          cat report.md